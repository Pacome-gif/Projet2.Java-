-- Création de la base de données
CREATE DATABASE bibliotheque_db;

-- Connexion à la base de données
\c bibliotheque_db;

-- Table des livres
CREATE TABLE livres (
    id SERIAL PRIMARY KEY,
    titre VARCHAR(255) NOT NULL,
    auteur VARCHAR(255) NOT NULL,
    categorie VARCHAR(100) NOT NULL,
    nombre_exemplaires INTEGER NOT NULL DEFAULT 1,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Table des membres
CREATE TABLE membres (
    id SERIAL PRIMARY KEY,
    nom VARCHAR(100) NOT NULL,
    prenom VARCHAR(100) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    adhesion_date DATE NOT NULL DEFAULT CURRENT_DATE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Table des emprunts
CREATE TABLE emprunts (
    id_emprunt SERIAL PRIMARY KEY,
    membre_id INTEGER NOT NULL,
    livre_id INTEGER NOT NULL,
    date_emprunt DATE NOT NULL DEFAULT CURRENT_DATE,
    date_retour_prevue DATE NOT NULL,
    date_retour_effective DATE,
    penalite DECIMAL(10, 2) DEFAULT 0.00,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (membre_id) REFERENCES membres(id) ON DELETE CASCADE,
    FOREIGN KEY (livre_id) REFERENCES livres(id) ON DELETE CASCADE
);

-- Index pour améliorer les performances
CREATE INDEX idx_livres_titre ON livres(titre);
CREATE INDEX idx_livres_auteur ON livres(auteur);
CREATE INDEX idx_livres_categorie ON livres(categorie);
CREATE INDEX idx_membres_nom ON membres(nom);
CREATE INDEX idx_emprunts_membre ON emprunts(membre_id);
CREATE INDEX idx_emprunts_livre ON emprunts(livre_id);

-- Insertion de données de test
INSERT INTO livres (titre, auteur, categorie, nombre_exemplaires) VALUES
('Le Petit Prince', 'Antoine de Saint-Exupéry', 'Roman', 5),
('1984', 'George Orwell', 'Science-Fiction', 3),
('L''Étranger', 'Albert Camus', 'Roman', 4),
('Les Misérables', 'Victor Hugo', 'Roman', 2),
('Introduction à Java', 'Kathy Sierra', 'Informatique', 6);

INSERT INTO membres (nom, prenom, email) VALUES
('Dupont', 'Jean', 'jean.dupont@email.com'),
('Martin', 'Marie', 'marie.martin@email.com'),
('Durand', 'Paul', 'paul.durand@email.com');